# Function Group API 改善計画

## 変更概要
Function Group (FG) 取得APIのレスポンス構造を改善し、より使いやすい形式にします。

## 変更日時
- 計画作成日: 2025-01-15
- 実装予定: 未定
- ブランチ: `feature/improve-fg-api`

## 現状の問題点

### 1. 複雑なレスポンス構造
現在のレスポンスは多重にJSON文字列化されており、クライアント側で複数回のパース処理が必要：
```json
{
  "responseJSON": "{
    \"fg\": \"[
      {
        \\\"fgCode\\\": \\\"A\\\",
        \\\"fgDescription\\\": \\\"機器・電気\\\"
      }
    ]\"
  }"
}
```

### 2. フィールド名の不一致
- 現在: `fgDescription`
- 改善後: `fgName` （より簡潔で分かりやすい）

### 3. データ形式の最適化
コロン区切りの名前形式を採用し、表示用データを統一

## 改善内容

### 新しいエンドポイント
```
GET /fgs
```

### 新しいレスポンス構造
```json
{
  "fgs": [
    {
      "fgCode": "A",
      "fgName": "A:ABCD"
    },
    {
      "fgCode": "B", 
      "fgName": "B:BCDE"
    }
  ]
}
```

### 主な改善点
1. **シンプルな構造**: 多重JSON文字列化を排除
2. **直感的なフィールド名**: `fgDescription` → `fgName`
3. **統一された表示形式**: `fgName`に`コード:名称`形式を採用
4. **RESTful設計**: 複数形の`/fgs`エンドポイント

## 実装タスク

### バックエンド
- [ ] 新しいエンドポイント `/fgs` の作成
- [ ] レスポンス形式の変更実装
- [ ] データ変換ロジックの実装（`fgCode:fgDescription`形式）
- [ ] 既存の`/GetFg`エンドポイントとの互換性維持（移行期間）

### フロントエンド
- [ ] 新しいAPI呼び出しフックの作成 (`useFunctionGroupsV2.ts`)
- [ ] 型定義の更新
  ```typescript
  export type FGV2 = {
    fgCode: string;
    fgName: string;  // "A:ABCD" 形式
  };
  ```
- [ ] データパース処理の簡略化
- [ ] UIコンポーネントの更新対応

### テスト
- [ ] APIエンドポイントのユニットテスト
- [ ] 統合テスト
- [ ] フロントエンドのテスト更新

## 影響範囲

### 影響を受けるコンポーネント
1. **Sidebar.tsx** - FG選択セレクトボックス
2. **MilestoneGrid.tsx** - マイルストーン管理
3. **useFgsStore** - グローバルステート管理

### 移行計画
1. **Phase 1**: 新APIエンドポイントの実装（既存APIと並行稼働）
2. **Phase 2**: フロントエンドの段階的移行
3. **Phase 3**: 旧APIの廃止

## メリット

1. **パフォーマンス向上**
   - 複数回のJSON.parse()が不要
   - レスポンスサイズの削減

2. **開発効率の向上**
   - シンプルなデータ構造により実装が簡潔に
   - エラーハンドリングの簡略化

3. **保守性の向上**
   - 標準的なREST API設計
   - 明確なデータ構造

## リスクと対策

### リスク
- 既存システムとの互換性問題
- 移行期間中の二重管理

### 対策
- 段階的移行アプローチ
- Feature Flagによる切り替え機能
- 十分なテスト期間の確保

## 次のステップ

1. この計画のレビューと承認
2. バックエンドAPIの実装
3. フロントエンドの対応実装
4. テストと検証
5. 段階的リリース

---

**注意**: この文書は計画段階のものであり、実装はまだ行われていません。